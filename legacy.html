
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <title>Legacy Immortality Engine - Thee Cigar Maestro</title>
      <link rel="stylesheet" href="style.css" />
      <style>
    .legacy-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: var(--spacing-xl);
    }
    
    .legacy-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-xxl);
      margin-top: var(--spacing-xl);
    }
    
    .legacy-card {
      background: var(--secondary-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: var(--spacing-xl);
      transition: var(--transition);
    }
    
    .legacy-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      border-color: var(--accent-text);
    }
    
    .card-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
      padding-bottom: var(--spacing-md);
      border-bottom: 1px solid var(--border-color);
    }
    
    .card-icon {
      font-size: 2rem;
    }
    
    .card-title {
      color: var(--accent-text);
      font-size: 1.3rem;
      margin: 0;
    }
    
    .recording-interface {
      background: var(--accent-bg);
      padding: var(--spacing-lg);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      margin: var(--spacing-lg) 0;
    }
    
    .recording-controls {
      display: flex;
      justify-content: center;
      gap: var(--spacing-md);
      margin: var(--spacing-lg) 0;
    }
    
    .record-btn {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .record-btn.record {
      background: linear-gradient(135deg, #dc3545, #c82333);
      color: white;
    }
    
    .record-btn.recording {
      background: #dc3545;
      animation: pulse 1s infinite;
    }
    
    .record-btn.stop {
      background: linear-gradient(135deg, #6c757d, #5a6268);
      color: white;
    }
    
    .record-btn.play {
      background: linear-gradient(135deg, var(--accent-text), var(--secondary-text));
      color: var(--primary-bg);
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.05); }
    }
    
    .recording-status {
      text-align: center;
      color: var(--secondary-text);
      margin: var(--spacing-md) 0;
    }
    
    .memory-form {
      display: grid;
      gap: var(--spacing-md);
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
    }
    
    .form-label {
      color: var(--accent-text);
      font-weight: bold;
    }
    
    .form-input,
    .form-textarea,
    .form-select {
      padding: var(--spacing-md);
      background: var(--primary-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      color: var(--primary-text);
      font-family: var(--font-family);
      transition: var(--transition);
    }
    
    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--accent-text);
      box-shadow: 0 0 0 2px rgba(198, 156, 109, 0.2);
    }
    
    .form-textarea {
      min-height: 120px;
      resize: vertical;
    }
    
    .emotion-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: var(--spacing-sm);
      margin: var(--spacing-md) 0;
    }
    
    .emotion-card {
      background: var(--primary-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: var(--spacing-md);
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .emotion-card:hover,
    .emotion-card.selected {
      background: var(--accent-text);
      color: var(--primary-bg);
      border-color: var(--accent-text);
      transform: scale(1.05);
    }
    
    .emotion-emoji {
      font-size: 2rem;
      margin-bottom: var(--spacing-sm);
    }
    
    .save-btn {
      background: linear-gradient(135deg, var(--accent-text), var(--secondary-text));
      color: var(--primary-bg);
      border: none;
      padding: var(--spacing-md) var(--spacing-xl);
      border-radius: var(--border-radius);
      cursor: pointer;
      font-family: var(--font-family);
      font-weight: bold;
      transition: var(--transition);
      margin-top: var(--spacing-lg);
    }
    
    .save-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(198, 156, 109, 0.3);
    }
    
    .memory-gallery {
      display: grid;
      gap: var(--spacing-md);
      max-height: 400px;
      overflow-y: auto;
    }
    
    .memory-item {
      background: var(--accent-bg);
      padding: var(--spacing-md);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      transition: var(--transition);
      cursor: pointer;
    }
    
    .memory-item:hover {
      background: var(--primary-bg);
      border-color: var(--accent-text);
    }
    
    .memory-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-sm);
    }
    
    .memory-title {
      font-weight: bold;
      color: var(--primary-text);
    }
    
    .memory-date {
      font-size: 0.8rem;
      color: var(--secondary-text);
    }
    
    .memory-preview {
      color: var(--secondary-text);
      font-size: 0.9rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .sharing-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: var(--spacing-md);
      margin-top: var(--spacing-lg);
    }
    
    .share-btn {
      background: var(--accent-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: var(--spacing-md);
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
      text-decoration: none;
      color: var(--primary-text);
    }
    
    .share-btn:hover {
      background: var(--accent-text);
      color: var(--primary-bg);
      border-color: var(--accent-text);
      transform: translateY(-2px);
    }
    
    .ritual-builder {
      background: var(--accent-bg);
      padding: var(--spacing-lg);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      margin-top: var(--spacing-lg);
    }
    
    .ritual-steps {
      display: grid;
      gap: var(--spacing-md);
      margin: var(--spacing-lg) 0;
    }
    
    .ritual-step {
      background: var(--primary-bg);
      padding: var(--spacing-md);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
    }
    
    .step-number {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: var(--accent-text);
      color: var(--primary-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
    }
    
    .step-content {
      flex: 1;
    }
    
    .step-title {
      font-weight: bold;
      color: var(--primary-text);
      margin-bottom: var(--spacing-xs);
    }
    
    .step-description {
      color: var(--secondary-text);
      font-size: 0.9rem;
    }
    
    .visualization {
      background: var(--primary-bg);
      padding: var(--spacing-lg);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      text-align: center;
      margin: var(--spacing-lg) 0;
    }
    
    .smoke-animation {
      font-size: 3rem;
      animation: float 3s ease-in-out infinite;
      margin: var(--spacing-lg) 0;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    .full-width {
      grid-column: 1 / -1;
    }
    
    @media (max-width: 1024px) {
      .legacy-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-lg);
      }
    }
    
    @media (max-width: 768px) {
      .recording-controls {
        flex-wrap: wrap;
      }
      
      .emotion-selector {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .sharing-options {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Legacy Immortality Engine</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="specs.html">Specs</a>
      <a href="pairing.html">Pairing</a>
      <a href="education.html">Education</a>
      <a href="legacy.html" class="active">Legacy</a>
      <a href="flavorverse.html">Flavorverse</a>
      <a href="nft.html">NFT Vault</a>
      <a href="kiosk.html">Kiosk</a>
      <a href="dashboard.html">Dashboard</a>
      <a href="contact.html">Contact</a>
    </nav>
  </header>

  <div class="legacy-container">
    <section>
      <h2>Preserve Your Ritual</h2>
      <p>Record your final draw. Gift a memory. Immortalize a moment in voice and smoke. Create lasting memories that transcend time, preserving the sacred rituals and emotional connections of your cigar journey.</p>
    </section>

    <div class="legacy-grid">
      <!-- Memory Recording Interface -->
      <div class="legacy-card">
        <div class="card-header">
          <span class="card-icon">üéôÔ∏è</span>
          <h3 class="card-title">Record Your Memory</h3>
        </div>
        
        <div class="memory-form">
          <div class="form-group">
            <label class="form-label">Memory Title</label>
            <input type="text" class="form-input" id="memoryTitle" placeholder="e.g., 'First Padron with Dad'">
          </div>
          
          <div class="form-group">
            <label class="form-label">Cigar Details</label>
            <input type="text" class="form-input" id="cigarDetails" placeholder="Brand, size, wrapper...">
          </div>
          
          <div class="form-group">
            <label class="form-label">Location & Occasion</label>
            <input type="text" class="form-input" id="location" placeholder="Where and when did this happen?">
          </div>
          
          <div class="form-group">
            <label class="form-label">Emotional Context</label>
            <div class="emotion-selector">
              <div class="emotion-card" data-emotion="joyful">
                <div class="emotion-emoji">üòä</div>
                <div>Joyful</div>
              </div>
              <div class="emotion-card" data-emotion="contemplative">
                <div class="emotion-emoji">üßò</div>
                <div>Contemplative</div>
              </div>
              <div class="emotion-card" data-emotion="celebratory">
                <div class="emotion-emoji">üéâ</div>
                <div>Celebratory</div>
              </div>
              <div class="emotion-card" data-emotion="nostalgic">
                <div class="emotion-emoji">üí≠</div>
                <div>Nostalgic</div>
              </div>
              <div class="emotion-card" data-emotion="peaceful">
                <div class="emotion-emoji">‚òÆÔ∏è</div>
                <div>Peaceful</div>
              </div>
              <div class="emotion-card" data-emotion="grateful">
                <div class="emotion-emoji">üôè</div>
                <div>Grateful</div>
              </div>
            </div>
          </div>
        </div>

        <div class="recording-interface">
          <h4 style="text-align: center; color: var(--accent-text); margin-bottom: var(--spacing-md);">Voice Recording</h4>
          <div class="recording-controls">
            <button class="record-btn record" id="recordBtn" onclick="toggleRecording()">
              üé§
            </button>
            <button class="record-btn play" id="playBtn" onclick="playRecording()" style="display: none;">
              ‚ñ∂Ô∏è
            </button>
          </div>
          <div class="recording-status" id="recordingStatus">Click to start recording your memory</div>
        </div>

        <div class="form-group">
          <label class="form-label">Written Memory</label>
          <textarea class="form-textarea" id="memoryText" placeholder="Describe the moment, the flavors, the company, the feelings... What made this smoke special?"></textarea>
        </div>

        <button class="save-btn" onclick="saveMemory()">üíæ Preserve This Memory</button>
      </div>

      <!-- Ritual Builder -->
      <div class="legacy-card">
        <div class="card-header">
          <span class="card-icon">üïØÔ∏è</span>
          <h3 class="card-title">Create Sacred Ritual</h3>
        </div>
        
        <p>Design a personal ritual that honors your smoking tradition and creates meaningful connections.</p>
        
        <div class="ritual-builder">
          <h4 style="color: var(--accent-text); margin-bottom: var(--spacing-md);">Your Ritual Steps</h4>
          <div class="ritual-steps">
            <div class="ritual-step">
              <div class="step-number">1</div>
              <div class="step-content">
                <div class="step-title">Preparation</div>
                <div class="step-description">Select your cigar, prepare your space, set your intention</div>
              </div>
            </div>
            <div class="ritual-step">
              <div class="step-number">2</div>
              <div class="step-content">
                <div class="step-title">Connection</div>
                <div class="step-description">Light the cigar with mindfulness, honor the moment</div>
              </div>
            </div>
            <div class="ritual-step">
              <div class="step-number">3</div>
              <div class="step-content">
                <div class="step-title">Reflection</div>
                <div class="step-description">Savor each draw, reflect on memories or hopes</div>
              </div>
            </div>
            <div class="ritual-step">
              <div class="step-number">4</div>
              <div class="step-content">
                <div class="step-title">Preservation</div>
                <div class="step-description">Record your thoughts, preserve the memory</div>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Ritual Name</label>
            <input type="text" class="form-input" id="ritualName" placeholder="e.g., 'Sunday Evening Contemplation'">
          </div>
          
          <div class="form-group">
            <label class="form-label">Special Elements</label>
            <textarea class="form-textarea" id="ritualElements" placeholder="Music, lighting, specific location, companions, timing..."></textarea>
          </div>
          
          <button class="save-btn" onclick="saveRitual()">üïØÔ∏è Create Ritual</button>
        </div>
      </div>

      <!-- Memory Gallery -->
      <div class="legacy-card">
        <div class="card-header">
          <span class="card-icon">üìö</span>
          <h3 class="card-title">Memory Gallery</h3>
        </div>
        
        <div class="memory-gallery" id="memoryGallery">
          <div class="memory-item" onclick="viewMemory(1)">
            <div class="memory-header">
              <div class="memory-title">First Cuban with Grandfather</div>
              <div class="memory-date">2 weeks ago</div>
            </div>
            <div class="memory-preview">Montecristo No. 2 on the porch, sharing stories of his youth in Havana...</div>
          </div>
          
          <div class="memory-item" onclick="viewMemory(2)">
            <div class="memory-header">
              <div class="memory-title">Wedding Celebration</div>
              <div class="memory-date">1 month ago</div>
            </div>
            <div class="memory-preview">Padron 1964 Anniversary with the groomsmen, celebrating friendship...</div>
          </div>
          
          <div class="memory-item" onclick="viewMemory(3)">
            <div class="memory-header">
              <div class="memory-title">Quiet Evening Reflection</div>
              <div class="memory-date">3 days ago</div>
            </div>
            <div class="memory-preview">Connecticut shade at sunset, processing the day's challenges...</div>
          </div>
        </div>
      </div>

      <!-- Legacy Sharing -->
      <div class="legacy-card">
        <div class="card-header">
          <span class="card-icon">üéÅ</span>
          <h3 class="card-title">Share Your Legacy</h3>
        </div>
        
        <p>Transform your memories into gifts that can be shared across time and space.</p>
        
        <div class="visualization">
          <div class="smoke-animation">üí®</div>
          <h4 style="color: var(--accent-text);">Legacy Visualization</h4>
          <p style="color: var(--secondary-text);">Your memories form a constellation of experiences, each smoke a star in your personal galaxy of taste and time.</p>
        </div>
        
        <div class="sharing-options">
          <a href="nft.html" class="share-btn">
            <div style="font-size: 1.5rem; margin-bottom: var(--spacing-xs);">üé®</div>
            <div>Mint as NFT</div>
          </a>
          <div class="share-btn" onclick="shareMemory('email')">
            <div style="font-size: 1.5rem; margin-bottom: var(--spacing-xs);">üìß</div>
            <div>Email Gift</div>
          </div>
          <div class="share-btn" onclick="shareMemory('qr')">
            <div style="font-size: 1.5rem; margin-bottom: var(--spacing-xs);">üì±</div>
            <div>QR Code</div>
          </div>
          <div class="share-btn" onclick="shareMemory('print')">
            <div style="font-size: 1.5rem; margin-bottom: var(--spacing-xs);">üñ®Ô∏è</div>
            <div>Print Card</div>
          </div>
          <div class="share-btn" onclick="shareMemory('social')">
            <div style="font-size: 1.5rem; margin-bottom: var(--spacing-xs);">üì±</div>
            <div>Social Media</div>
          </div>
          <div class="share-btn" onclick="shareMemory('time')">
            <div style="font-size: 1.5rem; margin-bottom: var(--spacing-xs);">‚è∞</div>
            <div>Time Capsule</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let mediaRecorder;
    let audioChunks = [];
    let isRecording = false;
    let selectedEmotion = '';

    // Emotion selection
    document.addEventListener('DOMContentLoaded', function() {
      const emotionCards = document.querySelectorAll('.emotion-card');
      emotionCards.forEach(card => {
        card.addEventListener('click', function() {
          emotionCards.forEach(c => c.classList.remove('selected'));
          this.classList.add('selected');
          selectedEmotion = this.dataset.emotion;
        });
      });
    });

    async function toggleRecording() {
      const recordBtn = document.getElementById('recordBtn');
      const playBtn = document.getElementById('playBtn');
      const status = document.getElementById('recordingStatus');

      if (!isRecording) {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorder = new MediaRecorder(stream);
          
          mediaRecorder.ondataavailable = event => {
            audioChunks.push(event.data);
          };
          
          mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            const audioUrl = URL.createObjectURL(audioBlob);
            playBtn.onclick = () => {
              const audio = new Audio(audioUrl);
              audio.play();
            };
            playBtn.style.display = 'block';
          };
          
          mediaRecorder.start();
          isRecording = true;
          
          recordBtn.innerHTML = '‚èπÔ∏è';
          recordBtn.className = 'record-btn recording';
          status.textContent = 'Recording... Click to stop';
          
        } catch (error) {
          status.textContent = 'Microphone access denied or not available';
          console.error('Error accessing microphone:', error);
        }
      } else {
        mediaRecorder.stop();
        mediaRecorder.stream.getTracks().forEach(track => track.stop());
        isRecording = false;
        
        recordBtn.innerHTML = 'üé§';
        recordBtn.className = 'record-btn record';
        status.textContent = 'Recording saved! Click play to listen';
      }
    }

    function playRecording() {
      // This function is dynamically assigned when recording stops
    }

    function saveMemory() {
      const title = document.getElementById('memoryTitle').value;
      const cigarDetails = document.getElementById('cigarDetails').value;
      const location = document.getElementById('location').value;
      const memoryText = document.getElementById('memoryText').value;
      
      if (!title || !memoryText) {
        alert('Please provide at least a title and written memory.');
        return;
      }
      
      const memory = {
        id: Date.now(),
        title,
        cigarDetails,
        location,
        emotion: selectedEmotion,
        text: memoryText,
        hasAudio: audioChunks.length > 0,
        date: new Date().toLocaleDateString()
      };
      
      // In a real app, this would save to a database
      let memories = JSON.parse(localStorage.getItem('legacyMemories') || '[]');
      memories.unshift(memory);
      localStorage.setItem('legacyMemories', JSON.stringify(memories));
      
      // Reset form
      document.getElementById('memoryTitle').value = '';
      document.getElementById('cigarDetails').value = '';
      document.getElementById('location').value = '';
      document.getElementById('memoryText').value = '';
      document.querySelectorAll('.emotion-card').forEach(c => c.classList.remove('selected'));
      selectedEmotion = '';
      audioChunks = [];
      document.getElementById('playBtn').style.display = 'none';
      document.getElementById('recordingStatus').textContent = 'Click to start recording your memory';
      
      updateMemoryGallery();
      alert('üåü Memory preserved! Your legacy grows stronger with each story.');
    }

    function saveRitual() {
      const ritualName = document.getElementById('ritualName').value;
      const ritualElements = document.getElementById('ritualElements').value;
      
      if (!ritualName) {
        alert('Please provide a name for your ritual.');
        return;
      }
      
      const ritual = {
        id: Date.now(),
        name: ritualName,
        elements: ritualElements,
        date: new Date().toLocaleDateString()
      };
      
      // In a real app, this would save to a database
      let rituals = JSON.parse(localStorage.getItem('personalRituals') || '[]');
      rituals.unshift(ritual);
      localStorage.setItem('personalRituals', JSON.stringify(rituals));
      
      // Reset form
      document.getElementById('ritualName').value = '';
      document.getElementById('ritualElements').value = '';
      
      alert('üïØÔ∏è Sacred ritual created! Your personal ceremony has been preserved.');
    }

    function updateMemoryGallery() {
      const gallery = document.getElementById('memoryGallery');
      const memories = JSON.parse(localStorage.getItem('legacyMemories') || '[]');
      
      // Keep existing default memories and add new ones
      const existingHtml = gallery.innerHTML;
      const newMemoriesHtml = memories.map(memory => `
        <div class="memory-item" onclick="viewMemory('${memory.id}')">
          <div class="memory-header">
            <div class="memory-title">${memory.title}${memory.hasAudio ? ' üéôÔ∏è' : ''}</div>
            <div class="memory-date">${memory.date}</div>
          </div>
          <div class="memory-preview">${memory.text.substring(0, 80)}...</div>
        </div>
      `).join('');
      
      if (newMemoriesHtml) {
        gallery.innerHTML = newMemoriesHtml + existingHtml;
      }
    }

    function viewMemory(id) {
      if (typeof id === 'string' && id.length > 3) {
        // User-created memory
        const memories = JSON.parse(localStorage.getItem('legacyMemories') || '[]');
        const memory = memories.find(m => m.id.toString() === id);
        if (memory) {
          alert(`üåü ${memory.title}\n\nüìç ${memory.location}\nüö¨ ${memory.cigarDetails}\nüòä ${memory.emotion}\nüìÖ ${memory.date}\n\nüìù ${memory.text}`);
        }
      } else {
        // Default memories
        const defaultMemories = {
          1: "First Cuban with Grandfather\n\nMontecristo No. 2 on the porch, sharing stories of his youth in Havana. The cedar and honey notes seemed to carry his memories across the decades. A sacred passing of tradition.",
          2: "Wedding Celebration\n\nPadron 1964 Anniversary with the groomsmen, celebrating friendship and new beginnings. The rich chocolate and spice matched the joy and excitement of the moment.",
          3: "Quiet Evening Reflection\n\nConnecticut shade at sunset, processing the day's challenges. The mild, creamy smoke provided comfort and clarity as the world settled into peace."
        };
        alert(`üìö ${defaultMemories[id] || 'Memory not found'}`);
      }
    }

    function shareMemory(type) {
      const shareMessages = {
        email: 'Creating email with your memory to share with loved ones...',
        qr: 'Generating QR code for easy sharing...',
        print: 'Preparing printable memory card...',
        social: 'Opening social media sharing options...',
        time: 'Creating time capsule to be opened in the future...'
      };
      
      alert(`üéÅ ${shareMessages[type]}\n\nIn a full implementation, this would integrate with the respective sharing services and NFT minting capabilities.`);
      
      if (type === 'email') {
        window.location.href = 'mailto:?subject=A Sacred Cigar Memory&body=I wanted to share a special memory from my cigar journey with you...';
      }
    }

    // Initialize memory gallery with any existing memories
    document.addEventListener('DOMContentLoaded', updateMemoryGallery);
  </script>
  
  <script type="module" src="gpt.js"></script>
</body>
</html>
    